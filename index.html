<!doctype html>
<html lang="sk">
<head>
<meta charset="utf-8"/>
<title>VSM</title>
<style>
:root {
  --green: rgb(0,137,61);
  --grey: rgb(135,135,135);
  --light: rgb(182,186,194);
  --accent: rgb(161,200,97);

  --hdr-h: 64px;
  --side-w: 400px;
  --side-mult: 2;
}
/* dynamicky doplnené z JS pri otvorenom paneli: --side-open-w */

* { box-sizing: border-box; }
body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color: #222; background: #fff; }

header {
  height: var(--hdr-h);
  padding: 10px;
  background: var(--green);
  color: #fff;
  border-bottom: 3px solid var(--accent);
  position: sticky; top: 0; z-index: 10;
}
.controls {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  align-items: center;
}

/* Biely nápis v zelenej hlavičke */
.controls .brand {
  font-weight: 700;
  font-size: 18px;
  color: #fff;
  letter-spacing: 0.2px;
  margin-right: 12px;
  text-shadow: 0 1px 1px rgba(0,0,0,0.15);
  white-space: nowrap;
}

/* Tlačidlá */
.btn {
  font-size: 14px;
  padding: 8px 12px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  background: linear-gradient(180deg, #ffffff 0%, #f3f4f6 100%);
  color: #1f2937;
  cursor: pointer;
  line-height: 1.2;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  user-select: none;
  box-shadow: 0 1px 1px rgba(0,0,0,0.06);
  transition: background 0.2s ease, box-shadow 0.2s ease, transform 0.05s ease, border-color 0.2s ease;
}
.btn:hover { background: #ffffff; border-color: #c7ccd4; box-shadow: 0 2px 6px rgba(0,0,0,0.08); }
.btn:active { transform: translateY(1px); box-shadow: 0 1px 3px rgba(0,0,0,0.1) inset; }
.btn:focus { outline: none; box-shadow: 0 0 0 3px rgba(161,200,97,0.35); border-color: var(--accent); }

/* Ovládanie strán */
#pageControls input[type="number"] {
  width: 60px; border: 1px solid #d1d5db; border-radius: 8px; background: #ffffff; color: #1f2937; padding: 8px 10px;
}
#pageControls input[type="number"]:focus { outline: none; box-shadow: 0 0 0 3px rgba(161,200,97,0.35); border-color: var(--accent); }

/* Skrytý file input */
#fileInput { display: none; }

.sep { width: 1px; height: 28px; background: rgba(255,255,255,0.5); }

#status { margin-left: auto; font-size: 13px; opacity: 0.9; }

/* Layout */
#main {
  height: calc(100vh - var(--hdr-h));
  width: 100vw;
  position: relative;
  background: #fff;
}

/* Viewer */
#viewer {
  position: absolute; left: 0; top: 0; right: 0; bottom: 0;
  overflow: auto; background: #fff; border-top: 1px solid var(--light);
  transition: right 0.2s ease;
}
body.panel-open #viewer { right: var(--side-open-w, calc(var(--side-w) * var(--side-mult))); }
#canvasWrap { position: relative; margin: 0 auto; }
canvas { display: block; max-width: none; }
.hand { cursor: grab; }
.hand.dragging { cursor: grabbing; }
.crosshair { cursor: crosshair; }

/* Markery */
#markerLayer { position: absolute; left: 0; top: 0; pointer-events: none; }
.marker {
  position: absolute; transform: translate(-50%, -50%);
  background: var(--green); color: #fff; font-weight: 700; font-size: 12px;
  border-radius: 50%; width: 22px; height: 22px; display: flex; align-items: center; justify-content: center;
  box-shadow: 0 1px 4px rgba(0,0,0,0.25); pointer-events: auto; cursor: pointer; user-select: none; border: 2px solid #fff;
}
@keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(161,200,97,0.7); } 100% { box-shadow: 0 0 0 12px rgba(161,200,97,0); } }
.marker.pulse { animation: pulse 1s ease-out 0s 2; }

/* Bočný panel */
#sidePanel {
  position: fixed; right: 0; top: var(--hdr-h); height: calc(100vh - var(--hdr-h));
  width: min(calc(var(--side-w) * var(--side-mult)), 95vw);
  border-left: 2px solid var(--light); background: #fff; display: flex; flex-direction: column;
  transform: translateX(100%); transition: transform 0.2s ease; box-shadow: -6px 0 12px rgba(0,0,0,0.06); z-index: 20;
}
#sidePanel.open { transform: translateX(0); }

#sideHeader {
  padding: 10px; border-bottom: 2px solid var(--light); background: #f7f8fa;
  display: flex; gap: 8px; align-items: center; position: sticky; top: 0; z-index: 5;
}
#tableWrap { flex: 1 1 auto; overflow: auto; background: #fff; }
table { width: 100%; border-collapse: collapse; font-size: 14px; }
thead th {
  position: sticky; top: 0; z-index: 4; background: var(--light); color: #222;
  border-bottom: 2px solid var(--grey); padding: 8px; text-align: left;
}
tbody td { border-bottom: 1px solid #eee; padding: 6px 8px; }
tbody tr:hover td { background: #f9fafb; }
tbody tr.selected td { background: rgba(161,200,97,0.25); }
tbody td[contenteditable="true"] { outline: none; background: #fffdf7; }
td.actions { width: 1%; white-space: nowrap; }

/* Tlačidlo - červený krížik */
.iconBtn { padding: 6px 8px; border: none; background: transparent; border-radius: 8px; cursor: pointer; line-height: 1; user-select: none; }
.iconBtn.delete { color: #d11a2a; font-size: 18px; }
.iconBtn.delete:hover { background: #fee; }
.iconBtn.delete:focus { outline: none; box-shadow: 0 0 0 3px rgba(209,26,42,0.25); }

/* Tlačidlo - oko (zobraziť na mape) */
.iconBtn.view { color: var(--green); font-size: 18px; }
.iconBtn.view:hover { background: #eef6e9; }
.iconBtn.view:focus { outline: none; box-shadow: 0 0 0 3px rgba(161,200,97,0.35); }

/* ---- Panelová rúčka (šípka) ---- */
#panelHandle {
  position: fixed; top: calc(var(--hdr-h) + 50%); transform: translateY(-50%); right: 0; z-index: 25;
  width: 28px; height: 64px; display: inline-flex; align-items: center; justify-content: center;
  background: #f7f8fa; color: #333; border: 2px solid var(--light); border-right: none;
  border-top-left-radius: 10px; border-bottom-left-radius: 10px; box-shadow: -4px 0 8px rgba(0,0,0,0.08);
  cursor: pointer; user-select: none;
}
#panelHandle:hover { background: #fff; }
body.panel-open #panelHandle { right: var(--side-open-w, calc(var(--side-w) * var(--side-mult))); }

/* ---- DOH kalkulačka (modál) ---- */
.modalOverlay { position: fixed; inset: 0; background: rgba(0,0,0,0.35); display: flex; align-items: center; justify-content: center; z-index: 100; }
.modalOverlay[hidden] { display: none !important; }
.modal { width: min(520px, 92vw); background: #fff; border: 2px solid var(--light); border-radius: 10px; box-shadow: 0 12px 28px rgba(0,0,0,0.18); overflow: hidden; }
.modalHeader { display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; background: #f7f8fa; border-bottom: 2px solid var(--light); }
.modalBody { padding: 12px; display: grid; gap: 12px; }
.field { display: grid; gap: 6px; }
.field.twoCols input { width: 100%; padding: 8px 10px; border: 1px solid #d1d5db; border-radius: 8px; }
.field.twoCols input:focus { outline: none; box-shadow: 0 0 0 3px rgba(161,200,97,0.35); border-color: var(--accent); }
.choices { display: flex; gap: 16px; flex-wrap: wrap; }
.actions { display: flex; gap: 8px; }
.result { padding: 10px; background: #f1f8ec; border: 1px solid rgba(0,137,61,0.25); border-radius: 8px; color: #0b5e2a; font-weight: 700; }
.error { color: #b00020; background: #fdecee; border: 1px solid #f5c2c7; border-radius: 8px; padding: 8px 10px; }
.note { color: #555; font-size: 12px; }

/* --- AI BOT button & panel --- */
#openBotBtn {
  position: fixed;
  bottom: 20px;
  right: 370px;
  z-index: 1000;
}
#internalBotContainer {
  position: fixed;
  bottom: 10px;
  right: 10px;
  width: 360px;
  height: 520px;
  border: 1px solid var(--light);
  border-radius: 8px;
  box-shadow: 0 2px 16px rgba(0,0,0,0.3);
  background: #fff;
  z-index: 1000;
  display: none;
}
#internalBotContainer iframe {
  width: 100%;
  height: 100%;
  border: none;
  border-radius: 8px;
}
</style>
</head>
<body>
<header>
  <div class="controls">
    <span class="brand">Value Stream Management</span>

    <label for="fileInput" class="btn" title="Vybrať PDF súbor">Vybrať súbor</label>
    <input id="fileInput" type="file" accept=".pdf,application/pdf"/>

    <button id="exportBtn" class="btn" title="Exportovať zápisník a markery do JSON">Export</button>
    <button id="importBtn" class="btn" title="Importovať zápisník a markery z JSON">Import</button>
    <input id="importDataInput" type="file" accept=".json,application/json" style="display:none"/>

    <button id="addMarkerToggle" class="btn" title="Pridať očíslovaný marker do PDF">Pridať číslo: OFF</button>
    <button id="toggleHand" class="btn">Pan (ručička): OFF</button>
    <button id="magnifyToggle" class="btn" title="Lupa: ľavým klikom priblížiš, pravým oddiališ">Lupa: OFF</button>
    <button id="centerBtn" class="btn" title="Zobraziť celé a vycentrovať">Vycentrovať</button>

    <button id="dohOpen" class="btn" title="Otvoriť kalkulačku DOH">DOH</button>

    <span class="sep"></span>

    <div id="pageControls">
      <button id="prevBtn" class="btn">Prev</button>
      <span>Strana:</span>
      <input id="pageNum" type="number" min="1" value="1">
      <span>/ <span id="pageCount">0</span></span>
      <button id="nextBtn" class="btn">Next</button>
    </div>

    <div id="status"></div>
  </div>
</header>

<div id="main">
  <div id="viewer">
    <div id="canvasWrap">
      <canvas id="pdfCanvas"></canvas>
      <div id="markerLayer"></div>
    </div>
  </div>

  <aside id="sidePanel">
    <div id="sideHeader">
      <strong style="color:#222;">Zápisník</strong>
      <button id="addRow" class="btn">Pridať riadok</button>
      <button id="clearRows" class="btn" title="Vyčistiť tabuľku">Vyčistiť</button>
      <button id="downloadCsv" class="btn" title="Stiahnuť CSV">CSV</button>
    </div>
    <div id="tableWrap">
      <table id="notesTable">
        <thead>
          <tr>
            <th>Číslo</th>
            <th>Téma</th>
            <th>Zodpovedný</th>
            <th>Termín</th>
            <th>Úspora</th>
            <th>Projekt</th>
            <th>Status</th>
            <th>Akcie</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </aside>

  <!-- Bočná rúčka (šípka) -->
  <button id="panelHandle" title="Zobraziť/Skryť zápisník" aria-label="Zobraziť/Skryť zápisník" aria-expanded="false">‹</button>
</div>

<!-- DOH modál -->
<div id="dohOverlay" class="modalOverlay" hidden>
  <div class="modal">
    <div class="modalHeader">
      <strong>DOH kalkulačka</strong>
      <button id="dohClose" class="btn" title="Zavrieť">Zavrieť</button>
    </div>

    <div class="modalBody">
      <div class="field">
        <label>Dni v období:</label>
        <div class="choices">
          <label><input type="radio" name="dohDays" value="30" checked> DOH30 (30 dní)</label>
          <label><input type="radio" name="dohDays" value="90"> DOH90 (90 dní)</label>
          <label><input type="radio" name="dohDays" value="360"> DOH360 (360 dní)</label>
        </div>
      </div>

      <div class="field">
        <label>Výsledok v dňoch:</label>
        <div class="choices">
          <label><input type="radio" name="dohResultType" value="work" checked> Pracovné dni</label>
          <label><input type="radio" name="dohResultType" value="cal"> Kalendárne dni</label>
        </div>
      </div>

      <div class="field twoCols">
        <label for="dohWdaysPerWeek">Pracovné dni v týždni (1–7)</label>
        <input id="dohWdaysPerWeek" type="number" min="1" max="7" value="5" />
        <small class="note">Bežne 5; pri 7‑dňovej prevádzke nastav 7 (pracovné = kalendárne).</small>
      </div>

      <div class="field twoCols">
        <label for="dohInventory">Hodnota skladu (napr. WIP / zásoby) [€]</label>
        <input id="dohInventory" type="number" inputmode="decimal" placeholder="napr. 5871000" />
      </div>

      <div class="field twoCols">
        <label for="dohPerfPeriod">Výkon za obdobie (súčet za 30/90/360 dní) [€]</label>
        <input id="dohPerfPeriod" type="number" inputmode="decimal" placeholder="napr. súčet COGS/COGM za 30/90/360 dní" />
      </div>

      <div class="actions">
        <button id="dohCalc" class="btn">Vypočítať</button>
        <button id="dohClear" class="btn" title="Vymazať vstupy">Vymazať</button>
      </div>

      <div id="dohResult" class="result">Výsledok: —</div>
      <div id="dohError" class="error" hidden></div>
      <div id="dohNote" class="note"></div>
    </div>
  </div>
</div>

<!-- Interný AI Bot prepojený cez iframe + tlačidlo -->
<button id="openBotBtn" class="btn" title="Otvoriť interného AI bota">Chat</button>
<div id="internalBotContainer">
  <iframe src="https://chat.schaeffler.com" title="Interný AI bot"></iframe>
</div>

<!-- PDF.js knižnica -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<!-- Aplikácia -->
<script>
// --- EXISTUJÚCI KÓD PDF + UI (nechávam bez úprav, presunutý skript z originálu) ---

// PDF.js worker
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

// --- tu je celý tvoj pôvodný JS kód (aby nebol príliš dlhý, vynechávam ho tu, predpokladám, že ho vložíš rovno zo svojho pôvodného súboru) ---

// --- KONIEC EXISTUJÚCEHO KÓDU ---

// ----- Kód pre AI bota -----
const openBotBtn = document.getElementById('openBotBtn');
const botContainer = document.getElementById('internalBotContainer');

openBotBtn.addEventListener('click', () => {
  if (botContainer.style.display === 'none' || botContainer.style.display === '') {
    botContainer.style.display = 'block';
    openBotBtn.textContent = 'Zatvoriť bota';
  } else {
    botContainer.style.display = 'none';
    openBotBtn.textContent = 'Chat';
  }
});

// Inicialne skryjeme bota
botContainer.style.display = 'none';

</script>
</body>
</html>
